'use strict';(function(l){function r(){var a=new Map,k={delete:function(d,c){if(k.has(d,c)){var b=a.get(d);b.has(c)&&b.delete(c);b.size||a.delete(d)}},set:function(d,c,b){c instanceof Function&&(a.has(d)||a.set(d,new Set),!0===b&&(c.__isOnce=!0),a.get(d).add(c))},get:function(d){return a.get(d)},has:function(d,c){return 0<a.size&&a.has(d)&&a.get(d).has(c)},loop:function(d,c){a.has(d)&&a.get(d).forEach(function(b,a){c(b);!0===b.__isOnce&&a.delete(b)})},makeHandle:function(a,c){if(!(c instanceof Function))throw new TypeError("eventsys : listener needs a function");
var b={on:function(){if(Array.isArray(a)){var e=!0,f=!1,h=void 0;try{for(var m=a[Symbol.iterator](),n;!(e=(n=m.next()).done);e=!0)k.set(n.value,c)}catch(g){f=!0,h=g}finally{try{!e&&m.return&&m.return()}finally{if(f)throw h;}}}else k.set(a,c);return b},once:function(){if(Array.isArray(a)){var e=!0,f=!1,h=void 0;try{for(var m=a[Symbol.iterator](),g;!(e=(g=m.next()).done);e=!0)k.set(g.value,c,!0)}catch(l){f=!0,h=l}finally{try{!e&&m.return&&m.return()}finally{if(f)throw h;}}}else k.set(a,c,!0);return b},
off:function(){if(Array.isArray(a)){var e=!0,f=!1,h=void 0;try{for(var g=a[Symbol.iterator](),n;!(e=(n=g.next()).done);e=!0)k.delete(n.value,c)}catch(l){f=!0,h=l}finally{try{!e&&g.return&&g.return()}finally{if(f)throw h;}}}else k.delete(a,c);return b}};return b}};return k}function u(a){a||(a={});var g=r(),d=!1;return v(a,{on:function(a,b){return g.makeHandle(a,b).on()},once:function(a,b){return g.makeHandle(a,b).once()},off:function(a,b){return g.makeHandle(a,b).off()},emit:function(c){if(d||"string"!==
typeof c)throw new TypeError("eventsys : you cannot emit that! "+c);var b=[].slice.call(arguments,1);g.loop(c,function(e){e.apply(a,b)})},stopall:function(a){return d="boolean"===typeof a?a:!0},defineHandle:function(c,b){b||(b=c);a[c]=function(e,f){return a[f?"once":"on"](b,e)}}})}function g(a,k){a||(a={});k||(a=u(a));var d=r();p(a,"isObservable",q(!0));["$get","$set"].map(function(b){var e="$get"==b?"Get":"Set";p(a,b,q(function(a,b){a instanceof Function&&(b=a,a="*");if(!(b instanceof Function))throw Error("."+
a+" no function");b.prop="string"===typeof a?a:"*";return d.makeHandle(e,b).on()}))});p(a,"get",q(function(b){if("get"!=b&&"set"!=b){var e=void 0;d.loop("Get",function(f){if("*"===f.prop||f.prop===b)e=f(b,a)});return void 0!=e?e:a[b]}return a[b]}));p(a,"set",q(function(b,e){var f=void 0;d.loop("Set",function(c){if("*"===c.prop||c.prop===b)f=c(b,e,a,Object.hasOwnProperty(a,b))});f=void 0!=f?f:e;t(f)&&!f.isObservable&&(f=g(f));a.emit("$uberset:"+b,f);a[b]=f}));for(var c in a)t(a[c])&&!a[c].isObservable&&
(a[c]=g(a[c]));if("undefined"!=typeof Proxy)return new Proxy(a,{get:function(a,e){if("get"!=e&&"set"!=e){var c=void 0;d.loop("Get",function(d){if("*"===d.prop||d.prop===e)c=d(e,a)});return void 0!=c?c:Reflect.get(a,e)}return Reflect.get(a,e)},set:function(a,c,f){var h=void 0,k=!1;d.loop("Set",function(d){if("*"===d.prop||d.prop===c)k?(f=h,k=!1):k=!0,h=d(c,f,a,!Reflect.has(a,c))});h=void 0!=h?h:f;t(h)&&!h.isObservable&&(h=g(h));a.emit("$uberset:"+c,h);return Reflect.set(a,c,h)}});console.warn("This JavaScript Environment does not support Proxy, observables need to use the .set and .get accessors to work");
return a}var t=function(a){return"[object Object]"===toString.call(a)},v=Object.assign,p=Object.defineProperty,q=function(a,g,d){return{value:a,write:"boolean"===typeof g?g:!1,enumerable:"boolean"===typeof d?d:!1}};g.observable=g;g.eventsys=u;g.listener=r;"undefined"!==typeof module?module.exports=g:l.define instanceof Function&&l.define.amd?l.define(["craft-observable"],function(){return g}):l.observable=g})("undefined"!==typeof global?global:window);
